{% extends 'store/base.html' %}
{% load static %}
{% load crispy_forms_tags %}

{% block content %}
<style>
  body {
    background-color: gray;
  }
</style>

<body>
  <br>
  <!-- 頁首標題 -->
  <div class="container bg-white shadow-md p-5 form-layout">
    <div style="display: flex; align-items: center; justify-content: center; position: relative;">
      <a href="{% url 'dashboard' %}" style="position: absolute; left: 0; color: #717070c8;">
        <i class="fa fa-undo fa-2x" aria-hidden="true"></i>
      </a>
      <h3 style="margin: 0;">My Orders</h3>
    </div>
    <hr>
  </div>

  <br>

  <!-- 訂單清單 -->
  <div class="container bg-white shadow-md p-5 form-layout">

    {% if page_obj %}
      {% for entry in page_obj %}
        <hr>
        <h5><i class="fa fa-bookmark" aria-hidden="true"></i>&nbsp;Order #{{ entry.order.id }}</h5>
        <small><i class="fa fa-calendar-o" aria-hidden="true"></i>&nbsp;Date: {{ entry.order.date_ordered }}</small>
        <span style="margin-left: 20px;">
          {% if entry.order.payment_status == "COMPLETED" %}
            <span class="badge bg-success">已付款</span>
          {% elif entry.order.payment_status == "PENDING" %}
            <span class="badge bg-warning text-dark">待確認</span>
          {% else %}
            <span class="badge bg-danger">未付款</span>
          {% endif %}
        </span>
        <br>

        <!-- 收件資訊 -->
        <div><i class="fa fa-map-marker" aria-hidden="true"></i>&nbsp;Shipping Address:
          {{ entry.order.shipping_address }}
        </div>
        <hr>

        <!-- 商品項目 -->
        {% for item in entry.items %}
          <div style="display: flex; align-items: center; margin-bottom: 15px;">
            <!-- 商品圖片 -->
            {% if item.product.thumbnail %}
              <img src="{{ item.product.thumbnail.url }}" alt="{{ item.product.title }}"
                   style="width: 130px; height: 130px; object-fit: cover; border-radius: 8px; margin-right: 15px;">
            {% else %}
              <img src="{% static 'images/no-image.png' %}" alt="No image"
                   style="width: 130px; height: 130px; object-fit: cover; border-radius: 8px; margin-right: 15px;">
            {% endif %}

            <!-- 商品資訊 -->
            <div>
              <strong>{{ item.product.title }}</strong><br>
              ${{ item.price }} × {{ item.quantity }}
            </div>
          </div>
        {% endfor %}

        <!-- 小計、運費、總額 -->
        <div style="text-align: right; margin-top: 10px;">
          <p class="mb-1"><strong>Subtotal:</strong> ${{ entry.order.subtotal }}</p>
          <p class="mb-1"><strong>Shipping:</strong> ${{ entry.order.shipping_fee }}</p>
          <p class="h5 fw-bold text-danger">Total: ${{ entry.order.amount_paid }}</p>
        </div>

        <br>
      {% endfor %}

      <!-- 分頁 -->
      <nav aria-label="Page navigation">
        <ul class="pagination justify-content-center">
          {% if page_obj.has_previous %}
            <li class="page-item">
              <a class="page-link" href="?page={{ page_obj.previous_page_number }}">上一頁</a>
            </li>
          {% endif %}

          {% for num in page_obj.paginator.page_range %}
            {% if page_obj.number == num %}
              <li class="page-item active">
                <span class="page-link">{{ num }}</span>
              </li>
            {% else %}
              <li class="page-item">
                <a class="page-link" href="?page={{ num }}">{{ num }}</a>
              </li>
            {% endif %}
          {% endfor %}

          {% if page_obj.has_next %}
            <li class="page-item">
              <a class="page-link" href="?page={{ page_obj.next_page_number }}">下一頁</a>
            </li>
          {% endif %}
        </ul>
      </nav>

    {% else %}
      <p>No orders found.</p>
    {% endif %}
  </div>
</body>
{% endblock content %}
