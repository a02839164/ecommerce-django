{% extends "./base.html" %}
{% load static %}

{% block content %}
<div class="bg-white">
  <main class="pt-5">

    <!-- üîπ ‰∏äÂçäÈÉ®ÔºöÂïÜÂìÅÂúñÁâá + Âü∫Êú¨Ë≥áË®ä -->
    <div class="container">
      <div class="row g-4">

        <!-- Â∑¶ÂÅ¥ÂúñÁâá -->
        <div class="col-md-5 col-lg-5 order-md-first bg-light p-3 rounded shadow-sm">
          {% if product.image %}
          <div class="d-flex flex-column align-items-start">
            <!-- ‰∏ªÂúñ -->
            <img id="mainImage" src="{{ product.image.0 }}" 
                 class="img-fluid rounded border mb-3" 
                 style="object-fit: contain; width: 100%; height: 400px;">
            <!-- Á∏ÆÂúñ -->
            {% if product.image|length > 1 %}
            <div class="d-flex flex-wrap">
              {% for img_path in product.image %}
              <img src="{{ img_path }}" 
                   class="thumbnail me-2 mb-2 border rounded" 
                   style="width: 70px; height: 70px; object-fit: cover; cursor: pointer;"
                   onclick="document.getElementById('mainImage').src=this.src">
              {% endfor %}
            </div>
            {% endif %}
          </div>
          {% else %}
          <p class="text-muted text-center mt-5">No image available</p>
          {% endif %}
        </div>

        <!-- Âè≥ÂÅ¥Ë≥áË®ä -->
        <div class="col-md-7 col-lg-7 ps-md-3 ps-lg-5">
          <h1 class="mb-2 fw-semibold">{{ product.title }}</h1>
          <p class="text-muted mb-3">{{ product.brand }}</p>
          <hr>

          <!-- ÂÉπÊ†º -->
          <p class="h4 fw-bold text-danger mb-4">$ {{ product.price }}</p>

          <!-- Êï∏Èáè -->
          <div class="mb-3">
            <label class="fw-semibold d-block mb-1">Qty</label>
            <div class="input-group" style="width:120px;">
              <button class="btn btn-outline-secondary btn-sm minus-btn">‚àí</button>
              <input type="text" id="product-qty" class="form-control text-center" 
                     inputmode="numeric" pattern="[0-9]*" value="1" min="1" max="99">
              <button class="btn btn-outline-secondary btn-sm plus-btn">+</button>
            </div>
          </div>

          <!-- Âä†ÂÖ•Ë≥ºÁâ©Ëªä -->
          <div class="mt-4">
            <button type="button" id="add-button" value="{{ product.id }}" 
                    class="btn btn-primary px-5 py-2 fw-semibold rounded-pill shadow-sm">
              <i class="fa-solid fa-cart-plus me-2"></i>Add to cart
            </button>
          </div>
        </div>

      </div>
    </div>

    <!-- üîπ ‰∏ãÂçäÈÉ®ÔºöÂïÜÂìÅË©≥Á¥∞Ë≥áË®äÔºàÂÖ®ÁôΩÂç°ÁâáÔºâ -->
    <section class="mt-5 py-5" style="background-color: #f8f9fa;">
      <div class="container">
        <div class="col-lg-10 mx-auto bg-white rounded-3 shadow-sm p-4">
          <h5 class="fw-semibold mb-4 text-center text-primary">Product Details</h5>
          <table class="table table-borderless align-middle mb-0 small">
            <tbody>
              <tr>
                <th class="fw-semibold" style="width: 25%;">Brand</th>
                <td class="text-muted">{{ product.brand }}</td>
              </tr>
              <tr>
                <th class="fw-semibold">Description</th>
                <td class="text-muted">{{ product.description }}</td>
              </tr>
              <tr>
                <th class="fw-semibold">Warranty</th>
                <td class="text-muted">{{ product.warrantyinformation }}</td>
              </tr>
              <tr>
                <th class="fw-semibold">Specifications</th>
                <td class="text-muted">
                  Depth: {{ product.dimensions.depth }} cm √ó 
                  Width: {{ product.dimensions.width }} cm √ó 
                  Height: {{ product.dimensions.height }} cm
                </td>
              </tr>
              <tr>
                <th class="fw-semibold">Shipping</th>
                <td class="text-muted">{{ product.shippinginformation }}</td>
              </tr>
              <tr>
                <th class="fw-semibold">Return Policy</th>
                <td class="text-muted">{{ product.returnpolicy }}</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </section>

  </main>
</div>

<!-- JS -->
<script>
document.addEventListener('DOMContentLoaded', function() {
  // Êï∏ÈáèÊéßÂà∂
  $(document).on('click', '.plus-btn, .minus-btn', function(e){
    e.preventDefault();
    const $input = $('#product-qty');
    let currentQty = parseInt($input.val()) || 1;
    if ($(this).hasClass('plus-btn')) currentQty++;
    else if ($(this).hasClass('minus-btn') && currentQty > 1) currentQty--;
    $input.val(currentQty);
  });

  // Âä†ÂÖ•Ë≥ºÁâ©Ëªä
  $(document).on('click', '#add-button', function(e){
    e.preventDefault();
    const productId = $(this).val();
    const productQty = parseInt($('#product-qty').val()) || 1;
    $.ajax({
      type: 'POST',
      url: '{% url "cart-add" %}',
      data: {
        product_id: productId,
        product_quantity: productQty,
        csrfmiddlewaretoken: "{{ csrf_token }}",
      },
      success: function(json){
        $('#cart-qty').text(json.qty);
        alert('‚úÖ Â∑≤Âä†ÂÖ•Ë≥ºÁâ©Ëªä');
      },
      error: function(xhr, errmsg, err){

        const msg = xhr.responseJSON?.error || "Âä†ÂÖ•Ë≥ºÁâ©ËªäÂ§±Êïó";
        alert("‚ùå " + msg);
        console.error('Add to cart failed', errmsg);
      }
    });
  });
});
</script>
{% endblock %}
